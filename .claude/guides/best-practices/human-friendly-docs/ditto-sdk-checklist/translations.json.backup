{
  "en": {
    "title": "Ditto SDK Implementation Checklist",
    "completed": "completed",
    "showCode": "Show Code",
    "hideCode": "Hide Code",
    "officialDoc": "Official Doc",
    "whatMeans": "What this means:",
    "whyMatters": "Why this matters:",
    "sections": [
      "Section 1: Initialization & API Basics",
      "Section 2: Data Modeling Fundamentals",
      "Section 3: Write Operations",
      "Section 4: Deletion & Storage Lifecycle",
      "Section 5: Read Operations & Queries",
      "Section 6: Subscriptions & Real-time Sync",
      "Section 7: Performance Optimization",
      "Section 8: Transactions",
      "Section 9: Attachments",
      "Section 10: Security",
      "Section 11: Observability & Testing"
    ]
  },
  "ja": {
    "title": "Ditto SDK実装チェックリスト",
    "completed": "完了",
    "showCode": "コードを表示",
    "hideCode": "コードを非表示",
    "officialDoc": "公式ドキュメント",
    "whatMeans": "概要:",
    "whyMatters": "解説:",
    "sections": [
      "セクション1: 初期化とAPI基礎",
      "セクション2: データモデリングの基礎",
      "セクション3: 書き込み操作",
      "セクション4: 削除とストレージライフサイクル",
      "セクション5: 読み取り操作とクエリ",
      "セクション6: サブスクリプションとリアルタイム同期",
      "セクション7: パフォーマンス最適化",
      "セクション8: トランザクション",
      "セクション9: 添付ファイル (Attachments)",
      "セクション10: セキュリティ",
      "セクション11: 可観測性とテスト"
    ],
    "items": [
      "適切な認証モードでDittoを初期化する",
      "Ditto初期化エラーを適切に処理する",
      "DQL API（現行）を使用し、レガシーBuilder APIを使用しない",
      "startSync()の前に必ずALTER SYSTEM SETをawaitする",
      "デバイス間で衝突する可能性のあるIDパターンを避ける",
      "可変データには配列ではなくMAPを使用する",
      "埋め込みと外部キー関係を適切に使い分ける",
      "大きなバイナリデータを直接ドキュメントに保存しない",
      "計算・派生フィールドをドキュメントに保存しない",
      "不要なデータをドキュメントから除外する",
      "ピア間の型安全性のためにDQL Strict Modeを有効化する [SDK 4.11+]",
      "安全な繰り返しINSERTにはON ID CONFLICT DO NOTHINGを使用する",
      "ドキュメント全体の置き換えではなくフィールドレベルのUPDATEを使用する",
      "同じ値でフィールドを不必要に更新しない",
      "効率的なアップサートにはDO UPDATE_LOCAL_DIFFを使用する [SDK 4.12+]",
      "分散カウンターにはCOUNTER型を使用する [SDK 4.14.0+]",
      "計算可能な派生値にはカウンターを使用しない",
      "イベント履歴には配列ではなく個別のドキュメントを使用する",
      "デバイスローカルテンプレートにはINITIAL DOCUMENTSを使用する",
      "Soft-DeleteとDELETEクエリの違いを理解する",
      "（Soft-Delete使用時）広くサブスクライブし、オブザーバー/クエリでフィルタする",
      "（Soft-Delete使用時）古い削除済みドキュメントを定期的にEVICTする",
      "（Soft-Delete使用時）ローカル削除のみにはEVICTを使用する",
      "（Soft-Delete使用時）再同期ループを防ぐためEVICT前にサブスクリプションをキャンセルする",
      "（DELETE使用時）トゥームストーンとTTL動作を理解する",
      "（DELETE使用時）huskedドキュメントとその防止方法を理解する",
      "（DELETE使用時）永久的で不可逆な削除にのみDELETEを使用する",
      "アプリケーションコードではなくクエリでデータをフィルタする",
      "大規模データセットにはクエリ結果のページネーションを使用する",
      "QueryResultItem参照を長期間保持しない",
      "リクエスト/レスポンスパターンではなく長期サブスクリプションを使用する",
      "広くサブスクライブし、オブザーバーでフィルタする（マルチホップリレー用）",
      "不要なデータにサブスクライブしない",
      "不要になったオブザーバーとサブスクリプションをキャンセルする",
      "バックプレッシャー制御にはregisterObserverWithSignalNextを使用する",
      "オブザーバーエラーを適切に処理する",
      "オブザーバーコールバックで重い処理を避ける",
      "選択的クエリにはCREATE INDEXを使用する [SDK 4.12+]",
      "インデックス使用を確認するためにEXPLAINを使用する [SDK 4.12+]",
      "N+1クエリパターン（複数の個別ルックアップ）を避ける",
      "複数の操作をトランザクションでバッチ処理する",
      "一貫性のある複数クエリ読み取りには読み取り専用トランザクションを使用する",
      "読み書きトランザクションをネストしない（デッドロックの原因）",
      "トランザクションは短く集中させる",
      "（Flutter固有）ditto.close()の前に必ず保留中のトランザクションをawaitする",
      "大きなバイナリデータ（画像、動画、ファイル）には添付ファイルを使用する",
      "添付ファイル取得エラーを適切に処理する",
      "添付ファイル取得タイムアウトを適切に設定する",
      "添付ファイルの可用性制約（直接ピアのみ）を理解する",
      "停止した添付ファイル取得のタイムアウト検出を実装する",
      "孤立した添付ファイルトークンを定期的にクリーンアップする",
      "Bluetooth LE転送用の添付ファイルサイズ制限を検討する",
      "本番アプリにはOnlineWithAuthenticationIdentityを使用する",
      "APIキー、トークン、認証情報をコミットしない",
      "適切な認証デリゲートコールバックを実装する",
      "完全オフライン展開にのみSharedKeyIdentityを使用する",
      "アプリケーションコードにSharedKeyをハードコードしない（セキュリティリスク）",
      "Dittoに挿入する前にユーザー入力を検証・サニタイズする",
      "機密データ（PII、パスワード）をDittoドキュメントに保存しない",
      "本番環境では最小ログレベルを有効化する",
      "デバッグ用にシステム情報をクエリする（SDK 4.13+）",
      "可観測性コールバックで同期ヘルスを監視する",
      "プレゼンスを使用して接続ピアを追跡する",
      "オフラインファースト動作をテストする（オフライン時にデータ作成）",
      "複数デバイスの競合シナリオをテストする",
      "削除パターン（Soft-DeleteとDELETE）をテストする",
      "SDK動作ではなくアプリケーション固有のビジネスロジックをテストする",
      "タイムスタンプ精度とクロックドリフト耐性をテストする"
    ],
    "whatMeansSections": [
      "<p><strong data-what-means>概要:</strong> 適切なIDモードを選択する:</p>\n<p>- <strong>開発環境:</strong> <code>OnlinePlaygroundIdentity</code>（テスト専用、アクセス制御なし）</p>\n<p>- <strong>本番環境:</strong> 認証デリゲート付き <code>OnlineWithAuthenticationIdentity</code></p>\n<p>- <strong>エアギャップ/オフライン環境:</strong> <code>SharedKeyIdentity</code>（クラウド同期なし）</p>",
      "<p><strong data-what-means>概要:</strong> <code>Ditto.open()</code>、<code>startSync()</code>、<code>execute()</code> を try-catch ブロックでラップする。無効なライセンス、ネットワーク利用不可、権限問題、またはクエリエラーなどのケースを処理する。</p>",
      "<p><strong data-what-means>概要:</strong> <code>ditto.store.execute('SELECT * FROM collection ...')</code> および関連するDQLメソッドを使用する。<code>ditto.store.collection('name').find()</code> のような非推奨のビルダーAPIは避ける。</p>",
      "<p><strong data-what-means>概要:</strong> <code>DQL_STRICT_MODE</code> などのシステム設定を構成する際は、<code>startSync()</code> や他の操作を呼び出す前に必ず <code>await</code> を使用する。</p>",
      "<p><strong data-what-means>概要:</strong> 複数のデバイスが独立してドキュメントを作成できる場合、連番カウンター、タイムスタンプ、またはデバイスベースのパターンをドキュメントIDに使用しない。グローバルに一意な識別子（UUID v4、ULID）を使用するか、Dittoに自動生成させる。複合キー（例: <code>{\"userId\": \"user123\", \"orderId\": \"&lt;uuid&gt;\"}</code>）は、その組み合わせが一意であることが保証されている場合に許容される。</p>",
      "<p><strong data-what-means>概要:</strong> 配列はLast-Write-Wins（REGISTER CRDT）を使用するため、複数のピアが同時に更新するとマージ競合が発生する。複数のデバイスで変更可能なデータには、一意のキーを持つMAP（オブジェクト）構造を使用する。</p>",
      "<p><strong data-what-means>概要:</strong> 関連データを単一のドキュメントに埋め込むか、外部キー参照で別のドキュメントにするかを決定する:</p>\n<p><strong>埋め込み（非正規化）:</strong></p>\n<p>- 関連データを親ドキュメント内に直接保存</p>\n<p>- すべてのデータを取得するのに単一のクエリが必要</p>\n<p>- ドキュメント間でデータ重複（複数の注文に同じ顧客情報）</p>\n<p>- すべての関連データが単一のユニットとして同期</p>\n<p>- 最適な用途: 一緒に取得される小さな静的データ（注文品目、住所付きユーザープロフィール）</p>\n<p><strong>外部キー（正規化）:</strong></p>\n<p>- 関連データを別のドキュメントに保存、IDで参照</p>\n<p>- 複数の連続したクエリが必要（DittoはJOINをサポートしていない）</p>\n<p>- データ重複なし、単一の情報源</p>\n<p>- 関連データが独立して同期</p>\n<p>- 最適な用途: 大きなデータ、頻繁に更新されるデータ、または独立してアクセスされるデータ（ユーザープロフィール、製品カタログ）</p>",
      "<p><strong data-what-means>概要:</strong> 画像、動画、または大きなファイルをbase64文字列としてドキュメントフィールドに保存しない。代わりにDitto添付ファイルを使用する。</p>",
      "<p><strong data-what-means>概要:</strong> 既存のデータから計算できるフィールド（例: <code>lineTotal = price × quantity</code>、<code>subtotal = sum(items)</code>、<code>total = subtotal + tax</code>）を保存しない。必要なときにアプリケーションコードでこれらの値を計算する。</p>",
      "<p><strong data-what-means>概要:</strong> Dittoドキュメントのすべてのフィールドは、メッシュネットワーク内のすべてのピアに同期され、帯域幅とストレージを消費する。デバイス間で必要な共有ビジネス状態を表すデータのみを含める。同期しないもの:</p>\n<p>- <strong>UI固有の状態:</strong> 展開/選択/ホバー状態、スクロール位置、アクティブなタブインデックス</p>\n<p>- <strong>一時的/過渡的な状態:</strong> アップロード進行状況、処理フラグ、再試行カウンター、ローディングインジケーター</p>\n<p>- <strong>デバイス固有のデータ:</strong> ローカルファイルパス、デバイスID（認可に必要でない限り）、デバイス機能</p>\n<p>- <strong>キャッシュ/派生データ:</strong> 他のフィールドから計算できる値または外部ソースから取得できる値</p>\n<p>- <strong>高頻度の短命データ:</strong> マウスカーソル位置、タイピングインジケーター、永続化不要なリアルタイムセンサー読み取り</p>\n<p>- <strong>デバッグ/開発データ:</strong> テストフラグ、デバッグカウンター、開発専用メタデータ</p>",
      "<p><strong data-what-means>概要:</strong> ピア間での型の一貫性を強制するためにDQL Strict Modeを有効化する [SDK 4.11+]</p>",
      "<p><strong data-what-means>概要:</strong> 安全な繰り返しINSERTには <code>ON ID CONFLICT DO NOTHING</code> を使用する</p>",
      "<p><strong data-what-means>概要:</strong> ドキュメント全体を置き換える代わりに、<code>UPDATE</code> を使用して特定のフィールドのみを変更する</p>",
      "<p><strong data-what-means>概要:</strong> 既に同じ値を持つフィールドを更新しない（不要な同期トラフィックを回避）</p>",
      "<p><strong data-what-means>概要:</strong> 効率的なアップサート（存在しない場合は挿入、存在する場合は更新）には <code>DO UPDATE_LOCAL_DIFF</code> を使用する [SDK 4.12+]</p>",
      "<p><strong data-what-means>概要:</strong> 分散カウンター（在庫数量、いいね数など）には <code>COUNTER</code> 型を使用する [SDK 4.14.0+]</p>",
      "<p><strong data-what-means>概要:</strong> 計算可能な派生値（合計、平均など）にはカウンターを使用しない</p>",
      "<p><strong data-what-means>概要:</strong> イベント履歴やログには配列ではなく個別のドキュメントを使用する</p>",
      "<p><strong data-what-means>概要:</strong> デバイスローカルテンプレートには <code>INITIAL DOCUMENTS</code> を使用する</p>",
      "<p><strong data-what-means>概要:</strong> Soft-Delete（論理削除）とDELETEクエリ（物理削除）の違いを理解する</p>",
      "<p><strong data-what-means>概要:</strong> （Soft-Delete使用時）広くサブスクライブし、オブザーバー/クエリでフィルタする</p>",
      "<p><strong data-what-means>概要:</strong> （Soft-Delete使用時）ストレージを解放するため、古い削除済みドキュメントを定期的にEVICTする</p>",
      "<p><strong data-what-means>概要:</strong> （Soft-Delete使用時）ローカルデバイスからのみドキュメントを削除し、他のピアには伝播させない場合は <code>EVICT</code> を使用する</p>",
      "<p><strong data-what-means>概要:</strong> （Soft-Delete使用時）EVICT前にサブスクリプションをキャンセルして再同期ループを防ぐ</p>",
      "<p><strong data-what-means>概要:</strong> （DELETE使用時）トゥームストーン（削除マーカー）とTTL（Time To Live）動作を理解する</p>",
      "<p><strong data-what-means>概要:</strong> （DELETE使用時）huskedドキュメント（DELETEとUPDATEの同時実行による）とその防止方法を理解する</p>",
      "<p><strong data-what-means>概要:</strong> （DELETE使用時）永久的で不可逆な削除にのみ <code>DELETE</code> を使用する</p>",
      "<p><strong data-what-means>概要:</strong> アプリケーションコードで結果をフィルタするのではなく、DQLクエリの <code>WHERE</code> 句でデータをフィルタする</p>",
      "<p><strong data-what-means>概要:</strong> 大規模データセット（>1000行）にはクエリ結果のページネーションを使用する</p>",
      "<p><strong data-what-means>概要:</strong> <code>QueryResultItem</code> オブジェクトへの参照を長期間保持しない</p>",
      "<p><strong data-what-means>概要:</strong> リクエスト/レスポンスパターンではなく長期サブスクリプションを使用する</p>",
      "<p><strong data-what-means>概要:</strong> マルチホップリレーを確実にするため、広くサブスクライブし（フィルタなしまたは緩いフィルタ）、オブザーバーで厳密にフィルタする</p>",
      "<p><strong data-what-means>概要:</strong> 不要なデータにサブスクライブしない（不要な同期トラフィックを回避）</p>",
      "<p><strong data-what-means>概要:</strong> 画面を離れるとき、コンポーネントを破棄するとき、またはデータが不要になったときに、オブザーバーとサブスクリプションをキャンセルする</p>",
      "<p><strong data-what-means>概要:</strong> バックプレッシャー制御には <code>registerObserverWithSignalNext</code> を使用する</p>",
      "<p><strong data-what-means>概要:</strong> オブザーバーコールバック内で発生するエラーを適切に処理する</p>",
      "<p><strong data-what-means>概要:</strong> オブザーバーコールバック内で重い処理（大規模なデータ変換、同期API呼び出し、ファイルI/Oなど）を実行しない</p>",
      "<p><strong data-what-means>概要:</strong> 選択的クエリ（特定の値やフィールド範囲でフィルタリング）には <code>CREATE INDEX</code> を使用する [SDK 4.12+]</p>",
      "<p><strong data-what-means>概要:</strong> <code>EXPLAIN</code> を使用してクエリがインデックスを使用しているか、フルコレクションスキャンを実行しているかを確認する [SDK 4.12+]</p>",
      "<p><strong data-what-means>概要:</strong> N+1クエリパターン（ループ内で個別のクエリを実行）を避ける</p>",
      "<p><strong data-what-means>概要:</strong> 複数の操作（INSERT、UPDATE、DELETE）を単一のトランザクションにバッチ処理する</p>",
      "<p><strong data-what-means>概要:</strong> 一貫性のある複数クエリ読み取りには読み取り専用トランザクションを使用する</p>",
      "<p><strong data-what-means>概要:</strong> 読み書きトランザクションをネストしない（デッドロックの原因となる）</p>",
      "<p><strong data-what-means>概要:</strong> トランザクション内の操作数と実行時間を最小限に抑える。重い計算、ネットワーク呼び出し、または長時間実行されるロジックを避ける。</p>",
      "<p><strong data-what-means>概要:</strong> （Flutter固有）Flutter SDKでは、<code>ditto.close()</code> を呼び出す前にすべての保留中のトランザクションを追跡し、<code>await Future.wait(pendingTransactions)</code> を使用する。他のプラットフォームとは異なり、Flutter SDKは自動的にトランザクションを待機しない。</p>",
      "<p><strong data-what-means>概要:</strong> 大きなバイナリデータ（通常 >100KB）をドキュメントフィールドにbase64文字列として保存しない。Ditto添付ファイルとして保存し、ドキュメントフィールドに添付ファイルトークンを保存してバイナリデータを参照する。</p>",
      "<p><strong data-what-means>概要:</strong> <code>fetchAttachment()</code> を try-catch ブロックでラップして、ピアの利用不可、ネットワークタイムアウト、または破損データなどのケースを処理する</p>",
      "<p><strong data-what-means>概要:</strong> <code>fetchAttachment()</code> のタイムアウトパラメータを使用して、遅いまたは利用できないピアの待機時間を制限する: <code>fetchAttachment(token, timeout: Duration(seconds: 30))</code></p>",
      "<p><strong data-what-means>概要:</strong> 添付ファイルは、既に添付ファイルを取得した<strong>直接ピア</strong>（直接接続されたデバイス）からのみ取得できる。デバイスAが添付ファイルを持ち、デバイスCがそれを必要とするマルチホップシナリオでは、デバイスB（中間）がまだ取得していない場合、デバイスCはデバイスAから取得できない。</p>",
      "<p><strong data-what-means>概要:</strong> Dittoの添付ファイル取得は、接続が停止したときにエラーを発生させない。単に進行が停止するだけ。進行監視ラッパーを実装して、タイムアウト期間（例: 5分）内に進行がないことを検出する。</p>",
      "<p><strong data-what-means>概要:</strong> 添付ファイルを含むドキュメントを削除するときは、添付ファイル参照の削除を検討する。対応するドキュメントのない添付ファイルトークンを定期的にスキャンする。</p>",
      "<p><strong data-what-means>概要:</strong> Bluetooth LEトランスポートに依存するモバイルデバイスでは、添付ファイルサイズを制限する（例: 画像は &lt;5MB、より大きなものにはサムネイルを使用）。Bluetooth経由での同期パフォーマンスをテストする。</p>",
      "<p><strong data-what-means>概要:</strong> <code>OnlineWithAuthenticationIdentity</code> でDittoを構成し、認証デリゲートを実装して認証システム（OAuth、JWT、カスタム）と統合する</p>",
      "<p><strong data-what-means>概要:</strong> Ditto App ID、認証トークン、APIキーには環境変数または安全なストレージを使用する。それらをハードコードしたり、バージョン管理にコミットしたりしない。</p>",
      "<p><strong data-what-means>概要:</strong> <code>onAuthenticationExpiringSoon()</code> および <code>onAuthenticationRequired()</code> コールバックを実装して、有効期限前にトークンを更新し、再認証を促す</p>",
      "<p><strong data-what-means>概要:</strong> <code>SharedKeyIdentity</code>（オフラインモード）はクラウド同期を無効にし、メッシュ認証に共有シークレットを使用する。クラウド接続が利用できない場合にのみ使用する。</p>",
      "<p><strong data-what-means>概要:</strong> <code>SharedKey</code> の値をモバイルアプリのソースコードに直接ハードコードしない。MDM（モバイルデバイス管理）を使用して安全な鍵配布を行うか、ランタイムプロビジョニングを伴うプラットフォーム固有の安全なストレージを使用する。</p>",
      "<p><strong data-what-means>概要:</strong> Dittoに挿入する前にユーザー入力を検証およびサニタイズする</p>",
      "<p><strong data-what-means>概要:</strong> PII、パスワード、またはトークンなどの機密データをDittoドキュメントに保存しない</p>",
      "<p><strong data-what-means>概要:</strong> 本番環境では最小ログレベル（WARNING または ERROR）を有効化する</p>",
      "<p><strong data-what-means>概要:</strong> <code>SELECT * FROM %%SYSTEM_INFO%%</code> を使用してデバッグ用のシステム情報をクエリする（SDK 4.13+）</p>",
      "<p><strong data-what-means>概要:</strong> 可観測性コールバックを使用して同期ヘルスを監視する</p>",
      "<p><strong data-what-means>概要:</strong> プレゼンスを使用して接続ピアを追跡する</p>",
      "<p><strong data-what-means>概要:</strong> オフラインファースト動作（オフライン時にデータを作成）をテストする</p>",
      "<p><strong data-what-means>概要:</strong> 複数のDittoインスタンスから同じドキュメントへの同時変更をシミュレートするテストを作成し、同期後のCRDTマージ動作を検証する</p>",
      "<p><strong data-what-means>概要:</strong> 削除パターン（Soft-DeleteとDELETE）をテストする</p>",
      "<p><strong data-what-means>概要:</strong> <strong>アプリケーションのビジネスロジックとデータモデル</strong>を同時シナリオ下で検証するテストを作成する</p>",
      "<p><strong data-what-means>概要:</strong> デバイスのクロックがずれている（例: デバイスAは5秒進んでいる、デバイスBは3秒遅れている）状況をシミュレートするテストを作成する。タイムスタンプベースのロジックが適切な許容範囲でクロックドリフトを処理することを検証する。</p>"
    ]
      "<p><strong data-what-means>概要:</strong> <code>Ditto.open()</code>、<code>startSync()</code>、<code>execute()</code> を try-catch ブロックでラップする。無効なライセンス、ネットワーク利用不可、権限問題、またはクエリエラーなどのケースを処理する。</p>",
      "<p><strong data-what-means>概要:</strong> <code>ditto.store.execute('SELECT * FROM collection ...')</code> および関連するDQLメソッドを使用する。<code>ditto.store.collection('name').find()</code> のような非推奨のビルダーAPIは避ける。</p>",
      "<p><strong data-what-means>概要:</strong> <code>DQL_STRICT_MODE</code> などのシステム設定を構成する際は、<code>startSync()</code> や他の操作を呼び出す前に必ず <code>await</code> を使用する。</p>",
      "<p><strong data-what-means>概要:</strong> 複数のデバイスが独立してドキュメントを作成できる場合、連番カウンター、タイムスタンプ、またはデバイスベースのパターンをドキュメントIDに使用しない。グローバルに一意な識別子（UUID v4、ULID）を使用するか、Dittoに自動生成させる。複合キー（例: <code>{\"userId\": \"user123\", \"orderId\": \"&lt;uuid&gt;\"}</code>）は、その組み合わせが一意であることが保証されている場合に許容される。</p>",
      "<p><strong data-what-means>概要:</strong> 配列はLast-Write-Wins（REGISTER CRDT）を使用するため、複数のピアが同時に更新するとマージ競合が発生する。複数のデバイスで変更可能なデータには、一意のキーを持つMAP（オブジェクト）構造を使用する。</p>",
      "<p><strong data-what-means>概要:</strong> 関連データを単一のドキュメントに埋め込むか、外部キー参照で別のドキュメントにするかを決定する:</p>\n<p><strong>埋め込み（非正規化）:</strong></p>\n<p>- 関連データを親ドキュメント内に直接保存</p>\n<p>- すべてのデータを取得するのに単一のクエリが必要</p>\n<p>- ドキュメント間でデータ重複（複数の注文に同じ顧客情報）</p>\n<p>- すべての関連データが単一のユニットとして同期</p>\n<p>- 最適な用途: 一緒に取得される小さな静的データ（注文品目、住所付きユーザープロフィール）</p>\n<p><strong>外部キー（正規化）:</strong></p>\n<p>- 関連データを別のドキュメントに保存、IDで参照</p>\n<p>- 複数の連続したクエリが必要（DittoはJOINをサポートしていない）</p>\n<p>- データ重複なし、単一の情報源</p>\n<p>- 関連データが独立して同期</p>\n<p>- 最適な用途: 大きなデータ、頻繁に更新されるデータ、または独立してアクセスされるデータ（ユーザープロフィール、製品カタログ）</p>",
      "<p><strong data-what-means>概要:</strong> 画像、動画、または大きなファイルをbase64文字列としてドキュメントフィールドに保存しない。代わりにDitto添付ファイルを使用する。</p>",
      "<p><strong data-what-means>概要:</strong> 既存のデータから計算できるフィールド（例: <code>lineTotal = price × quantity</code>、<code>subtotal = sum(items)</code>、<code>total = subtotal + tax</code>）を保存しない。必要なときにアプリケーションコードでこれらの値を計算する。</p>",
      "<p><strong data-what-means>概要:</strong> Dittoドキュメントのすべてのフィールドは、メッシュネットワーク内のすべてのピアに同期され、帯域幅とストレージを消費する。デバイス間で必要な共有ビジネス状態を表すデータのみを含める。同期しないもの:</p>\n<p>- <strong>UI固有の状態:</strong> 展開/選択/ホバー状態、スクロール位置、アクティブなタブインデックス</p>\n<p>- <strong>一時的/過渡的な状態:</strong> アップロード進行状況、処理フラグ、再試行カウンター、ローディングインジケーター</p>\n<p>- <strong>デバイス固有のデータ:</strong> ローカルファイルパス、デバイスID（認可に必要でない限り）、デバイス機能</p>\n<p>- <strong>キャッシュ/派生データ:</strong> 他のフィールドから計算できる値または外部ソースから取得できる値</p>\n<p>- <strong>高頻度の短命データ:</strong> マウスカーソル位置、タイピングインジケーター、永続化不要なリアルタイムセンサー読み取り</p>\n<p>- <strong>デバッグ/開発データ:</strong> テストフラグ、デバッグカウンター、開発専用メタデータ</p>",
      "<p><strong data-what-means>概要:</strong> ピア間での型の一貫性を強制するためにDQL Strict Modeを有効化する [SDK 4.11+]</p>",
      "<p><strong data-what-means>概要:</strong> 安全な繰り返しINSERTには <code>ON ID CONFLICT DO NOTHING</code> を使用する</p>",
      "<p><strong data-what-means>概要:</strong> ドキュメント全体を置き換える代わりに、<code>UPDATE</code> を使用して特定のフィールドのみを変更する</p>",
      "<p><strong data-what-means>概要:</strong> 既に同じ値を持つフィールドを更新しない（不要な同期トラフィックを回避）</p>",
      "<p><strong data-what-means>概要:</strong> 効率的なアップサート（存在しない場合は挿入、存在する場合は更新）には <code>DO UPDATE_LOCAL_DIFF</code> を使用する [SDK 4.12+]</p>",
      "<p><strong data-what-means>概要:</strong> 分散カウンター（在庫数量、いいね数など）には <code>COUNTER</code> 型を使用する [SDK 4.14.0+]</p>",
      "<p><strong data-what-means>概要:</strong> 計算可能な派生値（合計、平均など）にはカウンターを使用しない</p>",
      "<p><strong data-what-means>概要:</strong> イベント履歴やログには配列ではなく個別のドキュメントを使用する</p>",
      "<p><strong data-what-means>概要:</strong> デバイスローカルテンプレートには <code>INITIAL DOCUMENTS</code> を使用する</p>",
      "<p><strong data-what-means>概要:</strong> Soft-Delete（論理削除）とDELETEクエリ（物理削除）の違いを理解する</p>",
      "<p><strong data-what-means>概要:</strong> （Soft-Delete使用時）広くサブスクライブし、オブザーバー/クエリでフィルタする</p>",
      "<p><strong data-what-means>概要:</strong> （Soft-Delete使用時）ストレージを解放するため、古い削除済みドキュメントを定期的にEVICTする</p>",
      "<p><strong data-what-means>概要:</strong> （Soft-Delete使用時）ローカルデバイスからのみドキュメントを削除し、他のピアには伝播させない場合は <code>EVICT</code> を使用する</p>",
      "<p><strong data-what-means>概要:</strong> （Soft-Delete使用時）EVICT前にサブスクリプションをキャンセルして再同期ループを防ぐ</p>",
      "<p><strong data-what-means>概要:</strong> （DELETE使用時）トゥームストーン（削除マーカー）とTTL（Time To Live）動作を理解する</p>",
      "<p><strong data-what-means>概要:</strong> （DELETE使用時）huskedドキュメント（DELETEとUPDATEの同時実行による）とその防止方法を理解する</p>",
      "<p><strong data-what-means>概要:</strong> （DELETE使用時）永久的で不可逆な削除にのみ <code>DELETE</code> を使用する</p>",
      "<p><strong data-what-means>概要:</strong> アプリケーションコードで結果をフィルタするのではなく、DQLクエリの <code>WHERE</code> 句でデータをフィルタする</p>",
      "<p><strong data-what-means>概要:</strong> 大規模データセット（>1000行）にはクエリ結果のページネーションを使用する</p>",
      "<p><strong data-what-means>概要:</strong> <code>QueryResultItem</code> オブジェクトへの参照を長期間保持しない</p>",
      "<p><strong data-what-means>概要:</strong> リクエスト/レスポンスパターンではなく長期サブスクリプションを使用する</p>",
      "<p><strong data-what-means>概要:</strong> マルチホップリレーを確実にするため、広くサブスクライブし（フィルタなしまたは緩いフィルタ）、オブザーバーで厳密にフィルタする</p>",
      "<p><strong data-what-means>概要:</strong> 不要なデータにサブスクライブしない（不要な同期トラフィックを回避）</p>",
      "<p><strong data-what-means>概要:</strong> 画面を離れるとき、コンポーネントを破棄するとき、またはデータが不要になったときに、オブザーバーとサブスクリプションをキャンセルする</p>",
      "<p><strong data-what-means>概要:</strong> バックプレッシャー制御には <code>registerObserverWithSignalNext</code> を使用する</p>",
      "<p><strong data-what-means>概要:</strong> オブザーバーコールバック内で発生するエラーを適切に処理する</p>",
      "<p><strong data-what-means>概要:</strong> オブザーバーコールバック内で重い処理（大規模なデータ変換、同期API呼び出し、ファイルI/Oなど）を実行しない</p>",
      "<p><strong data-what-means>概要:</strong> 選択的クエリ（特定の値やフィールド範囲でフィルタリング）には <code>CREATE INDEX</code> を使用する [SDK 4.12+]</p>",
      "<p><strong data-what-means>概要:</strong> <code>EXPLAIN</code> を使用してクエリがインデックスを使用しているか、フルコレクションスキャンを実行しているかを確認する [SDK 4.12+]</p>",
      "<p><strong data-what-means>概要:</strong> N+1クエリパターン（ループ内で個別のクエリを実行）を避ける</p>",
      "<p><strong data-what-means>概要:</strong> 複数の操作（INSERT、UPDATE、DELETE）を単一のトランザクションにバッチ処理する</p>",
      "<p><strong data-what-means>概要:</strong> 一貫性のある複数クエリ読み取りには読み取り専用トランザクションを使用する</p>",
      "<p><strong data-what-means>概要:</strong> 読み書きトランザクションをネストしない（デッドロックの原因となる）</p>",
      "<p><strong data-what-means>概要:</strong> トランザクション内の操作数と実行時間を最小限に抑える。重い計算、ネットワーク呼び出し、または長時間実行されるロジックを避ける。</p>",
      "<p><strong data-what-means>概要:</strong> （Flutter固有）Flutter SDKでは、<code>ditto.close()</code> を呼び出す前にすべての保留中のトランザクションを追跡し、<code>await Future.wait(pendingTransactions)</code> を使用する。他のプラットフォームとは異なり、Flutter SDKは自動的にトランザクションを待機しない。</p>",
      "<p><strong data-what-means>概要:</strong> 大きなバイナリデータ（通常 >100KB）をドキュメントフィールドにbase64文字列として保存しない。Ditto添付ファイルとして保存し、ドキュメントフィールドに添付ファイルトークンを保存してバイナリデータを参照する。</p>",
      "<p><strong data-what-means>概要:</strong> <code>fetchAttachment()</code> を try-catch ブロックでラップして、ピアの利用不可、ネットワークタイムアウト、または破損データなどのケースを処理する</p>",
      "<p><strong data-what-means>概要:</strong> <code>fetchAttachment()</code> のタイムアウトパラメータを使用して、遅いまたは利用できないピアの待機時間を制限する: <code>fetchAttachment(token, timeout: Duration(seconds: 30))</code></p>",
      "<p><strong data-what-means>概要:</strong> 添付ファイルは、既に添付ファイルを取得した<strong>直接ピア</strong>（直接接続されたデバイス）からのみ取得できる。デバイスAが添付ファイルを持ち、デバイスCがそれを必要とするマルチホップシナリオでは、デバイスB（中間）がまだ取得していない場合、デバイスCはデバイスAから取得できない。</p>",
      "<p><strong data-what-means>概要:</strong> Dittoの添付ファイル取得は、接続が停止したときにエラーを発生させない。単に進行が停止するだけ。進行監視ラッパーを実装して、タイムアウト期間（例: 5分）内に進行がないことを検出する。</p>",
      "<p><strong data-what-means>概要:</strong> 添付ファイルを含むドキュメントを削除するときは、添付ファイル参照の削除を検討する。対応するドキュメントのない添付ファイルトークンを定期的にスキャンする。</p>",
      "<p><strong data-what-means>概要:</strong> Bluetooth LEトランスポートに依存するモバイルデバイスでは、添付ファイルサイズを制限する（例: 画像は &lt;5MB、より大きなものにはサムネイルを使用）。Bluetooth経由での同期パフォーマンスをテストする。</p>",
      "<p><strong data-what-means>概要:</strong> <code>OnlineWithAuthenticationIdentity</code> でDittoを構成し、認証デリゲートを実装して認証システム（OAuth、JWT、カスタム）と統合する</p>",
      "<p><strong data-what-means>概要:</strong> Ditto App ID、認証トークン、APIキーには環境変数または安全なストレージを使用する。それらをハードコードしたり、バージョン管理にコミットしたりしない。</p>",
      "<p><strong data-what-means>概要:</strong> <code>onAuthenticationExpiringSoon()</code> および <code>onAuthenticationRequired()</code> コールバックを実装して、有効期限前にトークンを更新し、再認証を促す</p>",
      "<p><strong data-what-means>概要:</strong> <code>SharedKeyIdentity</code>（オフラインモード）はクラウド同期を無効にし、メッシュ認証に共有シークレットを使用する。クラウド接続が利用できない場合にのみ使用する。</p>",
      "<p><strong data-what-means>概要:</strong> <code>SharedKey</code> の値をモバイルアプリのソースコードに直接ハードコードしない。MDM（モバイルデバイス管理）を使用して安全な鍵配布を行うか、ランタイムプロビジョニングを伴うプラットフォーム固有の安全なストレージを使用する。</p>",
      "<p><strong data-what-means>概要:</strong> Dittoに挿入する前にユーザー入力を検証およびサニタイズする</p>",
      "<p><strong data-what-means>概要:</strong> PII、パスワード、またはトークンなどの機密データをDittoドキュメントに保存しない</p>",
      "<p><strong data-what-means>概要:</strong> 本番環境では最小ログレベル（WARNING または ERROR）を有効化する</p>",
      "<p><strong data-what-means>概要:</strong> <code>SELECT * FROM %%SYSTEM_INFO%%</code> を使用してデバッグ用のシステム情報をクエリする（SDK 4.13+）</p>",
      "<p><strong data-what-means>概要:</strong> 可観測性コールバックを使用して同期ヘルスを監視する</p>",
      "<p><strong data-what-means>概要:</strong> プレゼンスを使用して接続ピアを追跡する</p>",
      "<p><strong data-what-means>概要:</strong> オフラインファースト動作（オフライン時にデータを作成）をテストする</p>",
      "<p><strong data-what-means>概要:</strong> 複数のDittoインスタンスから同じドキュメントへの同時変更をシミュレートするテストを作成し、同期後のCRDTマージ動作を検証する</p>",
      "<p><strong data-what-means>概要:</strong> 削除パターン（Soft-DeleteとDELETE）をテストする</p>",
      "<p><strong data-what-means>概要:</strong> <strong>アプリケーションのビジネスロジックとデータモデル</strong>を同時シナリオ下で検証するテストを作成する</p>",
      "<p><strong data-what-means>概要:</strong> デバイスのクロックがずれている（例: デバイスAは5秒進んでいる、デバイスBは3秒遅れている）状況をシミュレートするテストを作成する。タイムスタンプベースのロジックが適切な許容範囲でクロックドリフトを処理することを検証する。</p>"
    ]
  }
}